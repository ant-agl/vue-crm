"use strict";(self["webpackChunkVueCRM"]=self["webpackChunkVueCRM"]||[]).push([[877],{2877:function(e,t,s){s.r(t),s.d(t,{default:function(){return M}});var i=s(3396),l=s(9242),n=s(7139);const r=(0,i._)("div",{class:"page-title"},[(0,i._)("h3",null,"Новая запись")],-1),a={key:1,class:"center"},o={key:0},u=(0,i._)("span",null,"Расход",-1),c={key:1},d=(0,i._)("span",null,"Доход",-1),h=(0,i._)("br",null,null,-1),p={class:"input-field"},m=["value"],y=(0,i._)("label",null,"Выберите категорию",-1),g={class:"input-field"},f=(0,i._)("label",{for:"amount"},"Сумма",-1),v={key:0,class:"helper-text invalid"},w={class:"input-field"},$=(0,i._)("label",{for:"description"},"Описание",-1),_={key:0,class:"helper-text invalid"},k=(0,i._)("button",{class:"btn waves-effect waves-light",type:"submit"},[(0,i.Uk)(" Создать "),(0,i._)("i",{class:"material-icons right"},"send")],-1);function C(e,t,s,C,b,D){const V=(0,i.up)("AppLoader"),U=(0,i.up)("router-link");return(0,i.wg)(),(0,i.iD)("div",null,[r,e.loading?((0,i.wg)(),(0,i.j4)(V,{key:0})):0==e.categories.length?((0,i.wg)(),(0,i.iD)("p",a,[(0,i.Uk)(" Категорий пока нет. "),(0,i.Wm)(U,{to:"/categories"},{default:(0,i.w5)((()=>[(0,i.Uk)("Создать новую категорию")])),_:1})])):((0,i.wg)(),(0,i.iD)("form",{key:2,class:"form",onSubmit:t[5]||(t[5]=(0,l.iM)(((...e)=>D.sendForm&&D.sendForm(...e)),["prevent"]))},[D.hasCatOutcome?((0,i.wg)(),(0,i.iD)("p",o,[(0,i._)("label",null,[(0,i.wy)((0,i._)("input",{class:"with-gap",name:"type",type:"radio",value:"outcome","onUpdate:modelValue":t[0]||(t[0]=t=>e.type=t)},null,512),[[l.G2,e.type]]),u])])):(0,i.kq)("",!0),D.hasCatIncome?((0,i.wg)(),(0,i.iD)("p",c,[(0,i._)("label",null,[(0,i.wy)((0,i._)("input",{class:"with-gap",name:"type",type:"radio",value:"income","onUpdate:modelValue":t[1]||(t[1]=t=>e.type=t)},null,512),[[l.G2,e.type]]),d])])):(0,i.kq)("",!0),h,(0,i._)("div",p,[(0,i.wy)((0,i._)("select",{ref:"select","onUpdate:modelValue":t[2]||(t[2]=t=>e.current=t)},[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(D.filterCategories,(e=>((0,i.wg)(),(0,i.iD)("option",{key:e.id,value:e.id},(0,n.zw)(e.title),9,m)))),128))],512),[[l.bM,e.current]]),y]),(0,i._)("div",g,[(0,i.wy)((0,i._)("input",{id:"amount",type:"number","onUpdate:modelValue":t[3]||(t[3]=t=>e.sum=t),class:(0,n.C_)({invalid:e.v$.sum.$error})},null,2),[[l.nr,e.sum,void 0,{number:!0}]]),f,e.v$.sum.$error?((0,i.wg)(),(0,i.iD)("span",v," Минимальное значение "+(0,n.zw)(e.v$.sum.minValue.$params.min),1)):(0,i.kq)("",!0)]),(0,i._)("div",w,[(0,i.wy)((0,i._)("input",{id:"description",type:"text","onUpdate:modelValue":t[4]||(t[4]=t=>e.desc=t),class:(0,n.C_)({invalid:e.v$.desc.$error})},null,2),[[l.nr,e.desc]]),$,e.v$.desc.$error?((0,i.wg)(),(0,i.iD)("span",_," Обязательное поле ")):(0,i.kq)("",!0)]),k],32))])}var b=s(5778),D=s.n(b),V=s(4219),U=s(5420),q=s(65),F={setup:()=>({v$:(0,V.Xw)()}),data:()=>({loading:!0,select:null,sum:"",desc:"",type:"outcome",current:null}),computed:{...(0,q.Se)(["info","categories"]),filterCategories(){return this.categories.filter((e=>e.type===this.type))},hasCatIncome(){return this.categories.some((e=>"income"===e.type))},hasCatOutcome(){return this.categories.some((e=>"outcome"===e.type))}},watch:{filterCategories(){this.current=this.filterCategories?.[0].id,setTimeout((()=>{this.select=D().FormSelect.init(this.$refs.select)}))}},async mounted(){this.categories.length||await this.$store.dispatch("fetchCategories"),this.loading=!1,setTimeout((()=>{this.type=this.hasCatOutcome?"outcome":"income",this.current=this.filterCategories?.[0]?.id??null,setTimeout((()=>{this.select=D().FormSelect.init(this.$refs.select)}))}))},unmounted(){this.select?.destroy&&this.select.destroy()},validations:()=>({current:{required:U.C1},sum:{required:U.C1,minValue:(0,U.uv)(0)},desc:{required:U.C1}}),methods:{sendForm(){if(this.v$.$invalid)return void this.v$.$touch();const e={categoryId:this.current,sum:this.sum,desc:this.desc,type:this.type,date:(new Date).toJSON()};this.$store.dispatch("createRecord",e).then((e=>{if(!e)return;const t="income"==this.type?this.info.bill+this.sum:this.info.bill-this.sum;this.info.bill=t,this.$store.dispatch("updateInfo",{bill:t}),this.v$.$reset(),this.$message("Запись добавлена"),this.sum="",this.desc=""}))}}},S=s(89);const I=(0,S.Z)(F,[["render",C]]);var M=I}}]);
//# sourceMappingURL=877.02782a2f.js.map